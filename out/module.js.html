<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: module.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: module.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

var _typeof = typeof Symbol === "function" &amp;&amp; typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj &amp;&amp; typeof Symbol === "function" &amp;&amp; obj.constructor === Symbol &amp;&amp; obj !== Symbol.prototype ? "symbol" : typeof obj; };

String.prototype.endsWith = String.prototype.endsWith || function (searchString, position) {
    var subjectString = this.toString();
    if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {
        position = subjectString.length;
    }
    position -= searchString.length;
    var lastIndex = subjectString.lastIndexOf(searchString, position);
    return lastIndex !== -1 &amp;&amp; lastIndex === position;
};

Array.prototype.find = Array.prototype.find || function (predicate) {
    'use strict';

    if (this == null) {
        throw new TypeError('Array.prototype.find called on null or undefined');
    }
    if (typeof predicate !== 'function') {
        throw new TypeError('predicate must be a function');
    }
    var list = Object(this);
    var length = list.length >>> 0;
    var thisArg = arguments[1];

    for (var i = 0; i !== length; i++) {
        if (predicate.call(thisArg, this[i], i, list)) {
            return this[i];
        }
    }
    return undefined;
};

Array.prototype.map = Array.prototype.map || function (callback, thisArg) {
    var T, A, k;
    if (this == null) {
        throw new TypeError(' this is null or not defined');
    }
    var O = Object(this);
    var len = O.length >>> 0;
    if (typeof callback !== 'function') {
        throw new TypeError(callback + ' is not a function');
    }
    if (arguments.length > 1) {
        T = thisArg;
    }
    A = new Array(len);
    k = 0;
    while (k &lt; len) {
        var kValue, mappedValue;
        if (k in O) {
            kValue = O[k];
            mappedValue = callback.call(T, kValue, k, O);
            A[k] = mappedValue;
        }
        k++;
    }
    return A;
};

Array.prototype.some = Array.prototype.some || function (evaluator, thisArg) {
    'use strict';

    if (!this) {
        throw new TypeError('Array.prototype.some called on null or undefined');
    }

    if (typeof evaluator !== 'function') {
        if (typeof evaluator === 'string') {
            if (!(evaluator = eval(evaluator))) {
                throw new TypeError();
            }
        } else {
            throw new TypeError();
        }
    }

    var i;
    if (thisArg === undefined) {
        for (i in this) {
            if (evaluator(this[i], i, this)) {
                return true;
            }
        }
        return false;
    }
    for (i in this) {
        if (evaluator.call(thisArg, this[i], i, this)) {
            return true;
        }
    }
    return false;
};

var _Pochart = {
    priority: ["area", "column", "bar", "pie", "line", "spline", "scatter"]
};
/**
 * attach a chart to existed dom
 * @param {string} domElement - 目標的DOM或是該DOM的id
 * @param {json} dataTable - 從DataTable序列化出來的json資料
 */
_Pochart.attachChart = function (domElement, dataTable) {
    var _this = this;

    if (typeof domElement === "string") {
        domElement = document.getElementById(domElement);
    }
    if (typeof domElement.nodeName === "undefined") {
        console.error(domElement, "is not a dom element");
        return;
    }
    var keys = arguments[2];
    if (keys === undefined) {
        keys = Object.keys(dataTable[0]);
    }
    if (!Array.isArray(keys)) {
        console.error('keys should be a array, but we got ' + JSON.stringify(keys));
        keys = Object.keys(dataTable[0]);
    }
    var configs = arguments[3] || {};
    var series = [];

    keys.forEach(function (key) {
        var data = [];
        var config = configs[key] || {};
        for (var j = 0; j &lt; dataTable.length; j++) {
            data.push(dataTable[j][key]);
        }
        var ser = {
            type: config.type || "line",
            data: data,
            name: config.name || key
        };
        if (_typeof(config.yAxis) == "object") {
            config.yAxis.id = config.yAxis.id || key;
            ser.yAxis = config.yAxis.id;
        } else {
            ser.yAxis = '_pochart_default_yaxis_' + ser.type;
        }
        series.push(ser);
    });

    var yAxis = [];
    for (var key in configs) {
        var config = configs[key];
        var exists_axises = yAxis.map(function (axis) {
            return axis.id;
        });
        if (_typeof(config.yAxis) == "object" &amp;&amp; exists_axises.indexOf(config.yAxis.id) &lt; 0) {
            yAxis.push(config.yAxis);
        }
    }
    series.forEach(function (ser) {
        var axisName = yAxis.map(function (axis) {
            return axis.id;
        });
        if (ser.yAxis.indexOf("_pochart_default_yaxis") === 0 &amp;&amp; axisName.indexOf(ser.yAxis) &lt; 0) {
            var newAxis = { id: ser.yAxis };
            if (ser.type.indexOf("line") > -1) {
                newAxis.opposite = true;
            }
            yAxis.unshift(newAxis);
        }
    });

    series = series.sort(function (ser, ser2) {
        return _this.priority.indexOf(ser.type) - _this.priority.indexOf(ser2.type);
    });
    keys = series.map(function (ser) {
        return ser.name;
    });
    var chart_config = {
        series: series
    };
    if (yAxis.length > 0) {
        chart_config.yAxis = yAxis;
    }
    var chart = Highcharts.chart(domElement, chart_config);

    return new PochartController(chart, chart_config);
};

/**
 * PochartController
 * @constructor
 * @param {highchart} chart - Highchart物件
 * @param {object} config - 設定
 */
var PochartController = function PochartController(chart, config) {
    this.nameMap = {};
    var keys = config.series.map(function (ser) {
        return ser.name;
    });
    /**
     * 取得Highchart物件
     * @return {object}
     */
    this.GetHighchart = function () {
        return chart;
    };
    this.setXAxis = function () {
        chart.xAxis[0].setCategories(arguments[0]);
    };

    /**
     * 依據DataTable的欄位名稱來找出相對應的y軸
     * @param {string} key - DataTable的欄位名稱
     * @return {object}
     */
    this.findYAxis = function (key) {
        var _this2 = this;

        var result = chart.yAxis.find(function (axis) {
            return axis.series.some(function (ser) {
                return ser.name === key || ser.name === _this2.nameMap[key];
            });
        });
        if (!result) {
            console.error('can\'t find yAxis for "' + key + '", please make sure that input data has that colum"');
        }
        return result;
    };

    this.updateAxisConfig = function (key, property_name, value) {
        var targetAxis = this.findYAxis(key);
        if (targetAxis) {
            var _config = {};
            _config[property_name] = value;
            targetAxis.update(_config);
        }
    };

    this.setDataNames = function (key, values) {
        var _this3 = this;

        var target = chart.series.find(function (ser) {
            return ser.name === key || ser.name === _this3.nameMap[key];
        });
        target.data.forEach(function (elem, idx) {
            if (!values[idx]) {
                return;
            }
            elem.update({ name: values[idx] });
        });
    };

    /**
    * 設定Y軸的標籤
    * @param {string} key - DataTable的欄位名稱
    * @param {string} title - 標籤的內容
    */
    this.setYAxisLabel = function (key, title) {
        this.updateAxisConfig(key, "title", { "text": title });
    };

    /**
    * 設定Y軸的最小值
    * @param {string} key - DataTable的欄位名稱
    * @param {number} value - 最小值
    */
    this.setYAxisMinValue = function (key, value) {
        this.updateAxisConfig(key, "min", value);
    };

    /** * 設定Y軸的最大值
    * @param {string} key - DataTable的欄位名稱
    * @param {number} value - 最大值
    */
    this.setYAxisMaxValue = function (key, value) {
        this.updateAxisConfig(key, "max", value);
    };
    this.setLegendTitle = function (key, title) {
        var idx = keys.indexOf(key);
        var target = chart.legend.allItems[idx];
        if (target) {
            target.update({ name: title });
            this.nameMap[key] = title;
        }
    };

    // 設定圖表標題
    this.setTitle = function () {
        chart.setTitle({ text: arguments[0] });
    };

    // @param {boolean} flag - 是否讓column chart進行堆疊
    this.toggleStackedColumn = function () {
        var flag = arguments.length > 0 &amp;&amp; arguments[0] !== undefined ? arguments[0] : false;

        if (flag) {
            flag = "normal";
        } else {
            flag = null;
        }
        chart.update({
            plotOptions: {
                column: {
                    stacking: flag
                }
            }
        });
    };
};

/** @namespace */
var Pochart = {};
Pochart.initialized = false;
Pochart.action_queue = [];

/**
 * dynamicly load external resources
 * @param {string} url - the url of resource
 * @param {function} callback - callback function invoked after resource loaded
 */
Pochart.load = function (url, callback) {
    var res = null;
    if (url.endsWith("css")) {
        res = document.createElement('link');
        res.rel = 'stylesheet';
        res.type = 'text/css';
    } else {
        res = document.createElement('script');
        res.type = 'text/javascript';
        res.async = true;
    }
    if (res.readyState) {
        res.onreadystatechange = function () {
            if (script.readyState == "loaded" || script.readyState == "complete") {
                script.onreadystatechange = null;
                callback();
            }
        };
    } else {
        res.onload = function () {
            if (callback) {
                callback();
            }
        };
    }
    if (url.endsWith("css")) {
        res.href = url;
        document.getElementsByTagName("head")[0].appendChild(res);
    } else {
        res.src = url;
        document.getElementsByTagName("body")[0].appendChild(res);
    }
};

/**
 * detect whether Highcharts has been loaed
 * if not, pause all (attachChart) actions unitl Highcharts be loaded
 */
Pochart.initialize = function () {
    var _this4 = this;

    if (!this.IsHcLoaded()) {
        this.load('http://myvf.kh.asegroup.com/cdn/highcharts/5.0.2/code/css/highcharts.css', function () {
            _this4.load('http://myvf.kh.asegroup.com/cdn/highcharts/5.0.2/code/highcharts.js');
        });
    }

    setInterval(function () {
        if (_this4.action_queue.length === 0 || !_this4.IsHcLoaded()) {
            return;
        }
        var action = _this4.action_queue.pop();
        if (action) {
            action();
        }
    }, 50);
    this.initialized = true;
};

Pochart.IsHcLoaded = function () {
    return typeof Highcharts !== "undefined" &amp;&amp; typeof Highcharts !== "null";
};

/**
 * craete a PochartContollerPorxy that will delay all actions until Highcharts loaded
 */
Pochart.attachChart = function () {
    var _arguments = arguments;

    if (!this.initialized) {
        this.initialize();
    }
    var proxiedObject = null;
    this.action_queue.push(function () {
        proxiedObject = _Pochart.attachChart.apply(_Pochart, _arguments);
    });
    var NullChartObj = new PochartController({}, { series: [] });
    var properties = Object.getOwnPropertyNames(new PochartController({}, { series: [] })).filter(function (p) {
        return typeof NullChartObj[p] === "function";
    });
    var proxy = {};
    proxy.action_queue = [];
    setInterval(function () {
        if (proxy.action_queue.length == 0 || proxiedObject == null) {
            return;
        }
        var action = proxy.action_queue.pop();
        if (action) {
            action();
        }
    }, 50);
    properties.forEach(function (p) {
        proxy[p] = function () {
            var _arguments2 = arguments;

            proxy.action_queue.push(function () {
                proxiedObject[p].apply(proxiedObject, _arguments2);
            });
        };
    });
    return proxy;
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PochartController.html">PochartController</a></li></ul><h3>Namespaces</h3><ul><li><a href="Pochart.html">Pochart</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Jan 06 2017 17:02:11 GMT+0800 (台北標準時間)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
